## Redis Cluster集群

### 为什么需要集群
1. 并发量的需求
2. 数据量的需求
Redis 3.0提供Cluster功能，原生提供的集群的功能

### 集群的基础
#### 数据分布
1. 顺序分区

2. 哈希分区(如节点去买，取模)
* 节点取余
    * 客户端分片:哈希 + 取余
    * 添加节点后数据会发生严重的数据迁移(原来大量的缓存会失效，需要重新写入)
    * 迁移数量和添加节点数量有关:建议翻倍扩容
    * 不推荐使用
    
* 一致性哈希分区
    * 客户端分片:哈希 + 顺时针(优化取余)
    * 节点伸缩：只影响邻近节点，但是还是有数据迁移
    * 翻倍伸缩：保证最小迁移数据和负载均衡
    
* 虚拟槽分区(Redis Cluster采用的方式)
    * 预设虚拟槽:每个槽映射一个数据子集，一般比节点数大
    * 分为0-16383共16384的槽
    * CRC16(key) & 16383
    * 不存在数据迁移的问题
3.两者的对比   

| 分布方式  | 特点 |  典型产品  |  
| -----   | -----:  | :----: |  
| 哈希分布   | 数据分散度高      | 一致性哈希Memcache  |  
|            |数据分布与业务无关 | Redis Cluster      |
|            |无法顺序访问 | 其他缓存产品   |
|            |支持批量操作 |       |
| -----   | -----  | ---- |  
| 顺序分布   | 数据分散度倾斜      |BigTable       |
|    | 键值业务相关      |HBase       |     
|    | 可顺序访问      |       |     
|    | 支持批量操作      |       |      

### 集群的搭建
#### 集群的基本架构 