## 数据库设计优化
### 性能优化顺序
* 数据库结构设计和SQL语句
* 数据库存储引擎的选择和参数配置
* 系统选择和优化
* 硬件升级

### 数据库设计对性能的影响
* 过分的反范式化为表建立太多的列
* 过分的范式化造成太多的表关联
* 在OLTP环境使用不恰当的分区表
* 使用外键保证数据的完整性

### 数据库结构优化的目的
* 减少数据冗余
* 尽量避免数据维护中出现更新，插入和删除异常
    * 插入异常：如果表中的某个实体随着另一个实体而存在
    * 更新异常：如果更改表中的某个实体的单独属性时，需要要对多行进行更新
    * 删除异常：如果删除表中的某一实体则会导致其他实体的消失
* 节约数据存储空间
* 提高查询效率

### 数据库结构设计的步骤
* 需求分析：全面了解产品设计的存储需求
    * 存储需求
    * 数据处理需求
    * 数据的安全性和完整性
* 逻辑设计：设计数据的逻辑存储结构
    * 数据实体之间的逻辑关系，解决数据冗余和数据维护异常
* 物理设计：根据所使用的数据库特点进行表结构设计
    * 关系型数据库：Oracle， SQLServer， MySQL， PostgresSQL
    * 非关系型数据库：Mongo，Redis，HBase
    * 存储引擎：Innodb，MyiSAM
 
### 数据库的逻辑设计   
#### 数据库设计范式 
是数据库所遵循的一些设计规范，只要按照这些规范就可以设计出没有数据冗余和数据维护异常的数据库结构
1. 数据库设计的第一范式：数据库的每个属性都不可再分
    * 数据库的所有字段都只具有单一属性
    * 单一属性的列是由基本的数据类型所构成的
    * 设计出来的表都是简单的二维表
2. 数据库设计的第二范式：(要求其他字段都依赖于主键)
    * 要求一个表中只具有一个业务主键，也就是说符合第二范式的表中不能存在非主键列队对只对部分主键的依赖关系
 
3. 数据库设计的第三范式：(非主键的其他字段是不能互相依赖)
    * 指每一个非主属性既不部分依赖于也不传递依赖于业务主键，也就是在第二范式的基础上消除了非主属性
    对主键的传递依赖
    
#### 数据库的反范式化设计
反范式化相对于范式化而言，根据实际业务情况，适当的不必完全遵守数据库范式。
适当增加数据冗余，减少表之间的关联。

### 范式化和反范式化的优缺点
##### 范式化的优点
1. 可以尽量的减少数据冗余
2. 范式化的更新操作比反范式化更快
3. 范式化的表通常比反范式化更小
##### 范式化的缺点
1. 对于查询需要对多个表进行关联
2. 更难进行索引优化
##### 反范式化的优点
1. 减少表的关联
2. 更好的进行索引优化
##### 反范式化的缺点
1. 存在数据冗余和数据维护异常
2. 对数据的修改需要更多的成本

### 数据库的物理设计
#### 物理设计涉及的内容
1. 定义数据库、表及字段的命令规范
    * 命名遵守可读性原则
    * 命名遵守表意性原则
    * 命名遵守表长名原则
2. 选择合适的存储引擎
根据具体的应用场景选择具体的存储引擎
3.  为表中的字段选择合适的数据类型
    * 当一个列可以选择多种数据类型时，应该优先考虑数字类型，其次是日期或二进制类型，
最后是字符类型。
    * 对于相同级别的数据类型，应该优先选择占用空间小的数据类型
    * 整数类型
         * tinyint(1bit, -128~127)
         * smallint(2bits)
         * mediumint(3bits)
         * int(4bits)
         * bigint(8bits)
    * 实数类型  

    | 列类型  | 存储空间 |  是否是精确类型  |
    | -----   | -----:  | :----: |
    | FLOAT   | 4个字节      |   否    |
    | DOUBLE  | 4个字节      |   否    |
    | DECIMAL | 每4个字节存储9个数字，小数点占一个字节      |   是    |      
    如DECIMAL(18,9)需要9个字节来存储，如果财务数据需要使用DECIMAL
    * VARCHAR和CHAR类型：
        * varchar用于存储变长字符串，只占用必要的存储空间
        * 列的最大长度小于255则只占用一个额外字节用于记录字符串长度
        * 列的最大长度大于255则要占用两个额外字节用于记录字符串长度
    * VARCHAR长度的选择问题
        * 使用最小的符合需求的长度
        * varchar(5)和varchar(200)存储'MysQL'字符串性能不同
    * VARCHAR的适用场景
        * 字符串的最大长度比平均长度大很多
        * 字符串很少被更新
        * 使用了多字节字符集存储字符串
    * CHAR类型的存储特点
        * CHAR类型是定长
        * 字符串存储在CHAR类型的列中会删除末尾的空格
        * CHAR类型的最大宽度为255
    * CHAR的适用场景
        * 适合存储长度近似的值
        * CHAR类型适合存储短字符串
        * CHAR类型适合存储经常更新的字符串列
    * 日期类型
        * DATETIME类型，以YYYY-MM-DD HH:MM:SS.[.fraction]格式存储日期时间
        DATETIME类型与时区无关，只占用8个字节的存储空间，时间范围从1000-01-01
        00:00:00到9999-12-31 23:59:59
        * TIMESTAMP类型，同UNIX时间戳，存储了格林尼治时间1970年到1月1日到当前时间的秒数，
        以YYYY-MM-DD HH:MM:SS.[.fraction]的格式显示，占用4个字节，时间范围从1970-01-01到
        2038-01-19，显示依赖于所指定的时区
        * date类型，只需要三个字节可以存放日期，1000-01-01到9999-12-31
        * time类型，用于存储时间数据，格式为HH:MM:SS
    * 存储日期时间数据的注意事项
        * 不要使用存储类型来存储日期数据
            * 日期类型通常比字符串类型存储空间小
            * 日期类型可以在查找过滤时利用日期进行对比
            * 日期类型有丰富的处理函数，方便对日期类型进行日期计算
        * 使用Int存储日期时间不如使用TimeStamp类型
        
4. 建立数据库的表结构
#### Innodb主键的选择
* 主键应该尽可能的小
* 主键应该是顺序增长的
* Innodb的主键和业务主键可以不同