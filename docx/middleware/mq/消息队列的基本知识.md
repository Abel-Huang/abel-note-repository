# 消息队列的基本知识
## 消息队列特性
1. 业务无关：只做消息分发；
2. FIFO：先投递先到达；
3. 容灾：节点的动态增删和消息持久化；
4. 性能：吞吐量提升，系统内部通信效率提高。

## 为什么需要消息队列
1. 生产和消费的速度或稳定性等因素不一致。

## 消息队列好处
1. 业务解耦；
2. 最终一致性(结果有三种，成功，失败，不确定，会将结果记录下来，失败和不确定会采用补偿措施)；
3. 广播；
4. 错峰与流控。

## 消息队列的两种模式
1. 点对点: Queue, 不可重复消费
producer 将消息发送到 queue 中，consumer 从中消费消息，消息被消费后，queue 中不再存储
消息，queue 可以支持多个消费者，但是一条消息只会被一个消费者消费；
2. 发布/订阅: Topic,可重复消费
producer 将消息推到 topic， 所有订阅了该 topic 的 consumer 都可以消费该消息。

## 如何保证消息队列的有序性
单个queue是不会出现消息的顺序性问题的。一般会分布式情况下会会出现消息顺序问题。

## 消息队列的一致性
最终一致性(结果有三种，成功，失败，不确定，会将结果记录下来，失败和不确定会采用补偿措施)。

## 消息队列如何解决消息重复问题
1. 消费端保证消息消费的幂等性；
2. 保证消息的唯一性，并且使用去重表进行去重，并用日志进行记录。

## 消息队列的消息丢失问题
以 Kafka 为例，Kafka将每个Topic进行分区 Partition，以提高消息的并行处理，同时为保证高可用性，
每个分区都有一定数量的副本 Replica，这样当部分服务器不可用时副本所在服务器就可以接替上来，
保证系统可用性。在Leader上负责读写，Follower负责数据的同步。中间使用 ZK 进行选主。
kafka 消息一般是存在磁盘上的。